# ğŸ—ï¸ System Architecture Diagram

## Complete Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT APPLICATION                            â”‚
â”‚                      (Next.js / Frontend / API User)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ POST /api/scrape-followers
             â”‚ {accounts: [...], targetGender: "male", totalScrapeCount: 500000}
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FLASK API                                  â”‚
â”‚                        (Gunicorn Web Dyno)                              â”‚
â”‚                                                                         â”‚
â”‚  1. Validate request                                                    â”‚
â”‚  2. Create job record in Supabase (scrape_jobs)                       â”‚
â”‚  3. Split accounts into batches of 50                                  â”‚
â”‚  4. Queue Celery tasks in Redis                                        â”‚
â”‚  5. Return 202 Accepted with job_id                                    â”‚
â”‚                                                                         â”‚
â”‚  Response: {                                                            â”‚
â”‚    "job_id": "uuid-here",                                              â”‚
â”‚    "status_url": "/api/job-status/uuid",                              â”‚
â”‚    "total_batches": 10000                                              â”‚
â”‚  }                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ < 200ms response time âš¡
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            REDIS QUEUE                                  â”‚
â”‚                    (Heroku Redis or Local)                              â”‚
â”‚                                                                         â”‚
â”‚  Queue: celery                                                          â”‚
â”‚  â”œâ”€â”€ Task 1: scrape_account_batch (accounts[0:50])                    â”‚
â”‚  â”œâ”€â”€ Task 2: scrape_account_batch (accounts[50:100])                  â”‚
â”‚  â”œâ”€â”€ Task 3: scrape_account_batch (accounts[100:150])                 â”‚
â”‚  â””â”€â”€ ... (10,000 tasks for 500K accounts)                             â”‚
â”‚                                                                         â”‚
â”‚  After all batches: aggregate_scrape_results                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Tasks distributed to workers
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CELERY WORKERS                                  â”‚
â”‚                    (4-8 Worker Dynos/Processes)                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Worker 1   â”‚  â”‚  Worker 2   â”‚  â”‚  Worker 3   â”‚  â”‚  Worker 4   â”‚  â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚
â”‚  â”‚  Batch 1    â”‚  â”‚  Batch 2    â”‚  â”‚  Batch 3    â”‚  â”‚  Batch 4    â”‚  â”‚
â”‚  â”‚  (50 acc)   â”‚  â”‚  (50 acc)   â”‚  â”‚  (50 acc)   â”‚  â”‚  (50 acc)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚ Each worker processes:                            â”‚          â”‚
â”‚        â”‚ 1. Scrape followers (Apify)                       â”‚          â”‚
â”‚        â”‚ 2. Detect gender                                  â”‚          â”‚
â”‚        â”‚ 3. Filter by target gender                        â”‚          â”‚
â”‚        â”‚ 4. Return profiles                                â”‚          â”‚
â”‚        â”‚                                                    â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                â”‚                â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ Parallel processing ğŸš€
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APIFY ACTOR                                      â”‚
â”‚                  (Instagram Follower Scraper)                           â”‚
â”‚                                                                         â”‚
â”‚  Input: {                                                               â”‚
â”‚    usernames: ["nike", "adidas", ...],                                 â”‚
â”‚    max_count: 100                                                       â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  Output: [                                                              â”‚
â”‚    {id: "123", username: "john_doe", full_name: "John Doe", ...},      â”‚
â”‚    ...                                                                  â”‚
â”‚  ]                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Scraped profiles returned
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BATCH AGGREGATION                                    â”‚
â”‚              (Runs after all batches complete)                          â”‚
â”‚                                                                         â”‚
â”‚  aggregate_scrape_results task:                                         â”‚
â”‚  1. Combine all batch results                                          â”‚
â”‚  2. Insert into Supabase in chunks of 1000                             â”‚
â”‚  3. Update job status to "completed"                                   â”‚
â”‚  4. Record total_scraped and total_filtered                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Batch insert (1000 profiles/batch)
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SUPABASE DATABASE                               â”‚
â”‚                        (PostgreSQL + APIs)                              â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ scrape_jobs                                                       â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ job_id (UUID, PK)                                            â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ status ("queued" â†’ "processing" â†’ "completed")               â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ progress (0% â†’ 100%)                                         â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ profiles_scraped (incremental count)                         â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ total_batches, current_batch                                 â”‚  â”‚
â”‚  â”‚ â””â”€â”€ error_message (if failed)                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ scrape_results                                                    â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ id (SERIAL, PK)                                              â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ job_id (UUID, FK)                                            â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ profile_id, username, full_name                              â”‚  â”‚
â”‚  â”‚ â””â”€â”€ created_at                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Job complete, results stored
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT POLLING                                  â”‚
â”‚                                                                         â”‚
â”‚  Loop every 5 seconds:                                                  â”‚
â”‚                                                                         â”‚
â”‚  GET /api/job-status/{job_id}                                          â”‚
â”‚  â†“                                                                      â”‚
â”‚  {                                                                      â”‚
â”‚    "status": "processing",                                             â”‚
â”‚    "progress": 45.5,                                                   â”‚
â”‚    "profiles_scraped": 227500                                          â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  If status === "completed":                                            â”‚
â”‚                                                                         â”‚
â”‚  GET /api/job-results/{job_id}?page=1&limit=1000                       â”‚
â”‚  â†“                                                                      â”‚
â”‚  {                                                                      â”‚
â”‚    "profiles": [{...}, {...}, ...],                                    â”‚
â”‚    "total": 500000,                                                    â”‚
â”‚    "page": 1,                                                          â”‚
â”‚    "limit": 1000                                                       â”‚
â”‚  }                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow (500K Accounts Example)

### Phase 1: Job Creation (< 1 second)
```
Client â†’ Flask API
â”œâ”€â”€ Validate 10,000 accounts
â”œâ”€â”€ Calculate: 10,000 accounts Ã— 50 followers each = 500,000 target
â”œâ”€â”€ Batch size: 50 accounts/worker
â”œâ”€â”€ Total batches: 10,000 Ã· 50 = 200 batches
â”œâ”€â”€ Create job record in scrape_jobs
â””â”€â”€ Queue 200 Celery tasks in Redis

Response: 202 Accepted + job_id
Time: ~200ms âš¡
```

### Phase 2: Parallel Processing (3-8 hours)
```
Worker 1              Worker 2              Worker 3              Worker 4
â”œâ”€ Batch 1 (50 acc)   â”œâ”€ Batch 2 (50 acc)   â”œâ”€ Batch 3 (50 acc)   â”œâ”€ Batch 4 (50 acc)
â”‚  â†“ Apify scrape     â”‚  â†“ Apify scrape     â”‚  â†“ Apify scrape     â”‚  â†“ Apify scrape
â”‚  â†“ Gender detect    â”‚  â†“ Gender detect    â”‚  â†“ Gender detect    â”‚  â†“ Gender detect
â”‚  â†“ Filter           â”‚  â†“ Filter           â”‚  â†“ Filter           â”‚  â†“ Filter
â”‚  â†“ Return ~2500     â”‚  â†“ Return ~2500     â”‚  â†“ Return ~2500     â”‚  â†“ Return ~2500
â”‚                     â”‚                     â”‚                     â”‚
â”œâ”€ Batch 5 (50 acc)   â”œâ”€ Batch 6 (50 acc)   â”œâ”€ Batch 7 (50 acc)   â”œâ”€ Batch 8 (50 acc)
â”‚  â†“ ...              â”‚  â†“ ...              â”‚  â†“ ...              â”‚  â†“ ...
...                   ...                   ...                   ...
â””â”€ Batch 197          â””â”€ Batch 198          â””â”€ Batch 199          â””â”€ Batch 200

Each worker:
- Memory: < 1GB
- Time per batch: ~1-3 min
- Retries: 3x on failure
- Updates job progress in real-time
```

### Phase 3: Aggregation (5-15 minutes)
```
aggregate_scrape_results task:
â”œâ”€â”€ Collect results from all 200 batches
â”œâ”€â”€ Total profiles: ~500,000
â”‚
â”œâ”€â”€ Batch insert into scrape_results (chunks of 1000)
â”‚   â”œâ”€â”€ Insert 1-1000
â”‚   â”œâ”€â”€ Insert 1001-2000
â”‚   â”œâ”€â”€ Insert 2001-3000
â”‚   â””â”€â”€ ... (500 inserts total)
â”‚
â”œâ”€â”€ Update scrape_jobs:
â”‚   â”œâ”€â”€ status = "completed"
â”‚   â”œâ”€â”€ total_scraped = 500,000
â”‚   â”œâ”€â”€ progress = 100.0
â”‚   â””â”€â”€ completed_at = NOW()
â”‚
â””â”€â”€ Job complete âœ…
```

### Phase 4: Result Retrieval (< 1 second per page)
```
Client polls /api/job-status/{job_id}
â”œâ”€â”€ Check every 5 seconds
â”œâ”€â”€ Progress: 0% â†’ 25% â†’ 50% â†’ 75% â†’ 100%
â””â”€â”€ Status: "queued" â†’ "processing" â†’ "completed"

Client fetches /api/job-results/{job_id}?page=1&limit=1000
â”œâ”€â”€ Page 1: Profiles 1-1000
â”œâ”€â”€ Page 2: Profiles 1001-2000
â”œâ”€â”€ Page 3: Profiles 2001-3000
â””â”€â”€ ... (500 pages total)
```

---

## Scaling Diagram

### Development (1-100 profiles)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask   â”‚â”€â”€â”€â†’â”‚ Redis  â”‚â”€â”€â”€â†’â”‚  Worker  â”‚
â”‚  (Local) â”‚    â”‚(Local) â”‚    â”‚  (x1)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Cost: $0/month
```

### Production (1K-10K profiles)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask   â”‚â”€â”€â”€â†’â”‚  Redis   â”‚â”€â”€â”€â†’â”‚  Workers  â”‚
â”‚ Standard â”‚    â”‚   Mini   â”‚    â”‚  (x2-4)   â”‚
â”‚   -1X    â”‚    â”‚          â”‚    â”‚ Standard  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Cost: ~$140/month
```

### Scale (100K-500K profiles)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask   â”‚â”€â”€â”€â†’â”‚  Redis   â”‚â”€â”€â”€â†’â”‚  Workers  â”‚
â”‚ Standard â”‚    â”‚ Premium  â”‚    â”‚  (x8-16)  â”‚
â”‚   -2X    â”‚    â”‚    -0    â”‚    â”‚ Standard  â”‚
â”‚  (x2)    â”‚    â”‚          â”‚    â”‚   -2X     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Cost: ~$465/month
```

### Enterprise (1M+ profiles)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask   â”‚â”€â”€â”€â†’â”‚  Redis   â”‚â”€â”€â”€â†’â”‚  Workers  â”‚
â”‚Performanceâ”‚   â”‚ Premium  â”‚    â”‚  (x16-32) â”‚
â”‚    -L     â”‚    â”‚    -5    â”‚    â”‚Performanceâ”‚
â”‚  (x4)     â”‚    â”‚          â”‚    â”‚    -L     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Cost: ~$1500/month
```

---

## Error Handling Flow

```
                    Request
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Validation   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   âœ— Invalid â”€â”€â†’ 400 Bad Request
                       â”‚
                   âœ“ Valid
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Create Job   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   âœ— DB Error â”€â”€â†’ 500 Internal Error
                       â”‚
                   âœ“ Created
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Queue Tasks  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   âœ— Queue Full â”€â”€â†’ 503 Service Unavailable
                       â”‚
                   âœ“ Queued
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Worker Process â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   âœ— Fail â”€â”€â†’ Retry (3x)
                       â”‚           â”‚
                       â”‚       After 3 fails
                       â”‚           â†“
                       â”‚      Update job:
                       â”‚      status = "failed"
                       â”‚      error_message = "..."
                       â”‚
                   âœ“ Success
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Store Results  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   âœ— DB Error â”€â”€â†’ Retry (3x)
                       â”‚
                   âœ“ Stored
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Job Complete   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monitoring Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MONITORING STACK                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Flask API Metrics                                       â”‚
â”‚     â”œâ”€â”€ Request rate (req/min)                             â”‚
â”‚     â”œâ”€â”€ Response time (ms)                                 â”‚
â”‚     â”œâ”€â”€ Error rate (%)                                     â”‚
â”‚     â””â”€â”€ Active connections                                 â”‚
â”‚                                                             â”‚
â”‚  2. Celery Worker Metrics                                  â”‚
â”‚     â”œâ”€â”€ Tasks processed/min                                â”‚
â”‚     â”œâ”€â”€ Queue length                                       â”‚
â”‚     â”œâ”€â”€ Worker CPU/Memory                                  â”‚
â”‚     â””â”€â”€ Task success rate                                  â”‚
â”‚                                                             â”‚
â”‚  3. Redis Metrics                                          â”‚
â”‚     â”œâ”€â”€ Queue depth                                        â”‚
â”‚     â”œâ”€â”€ Memory usage                                       â”‚
â”‚     â”œâ”€â”€ Connection count                                   â”‚
â”‚     â””â”€â”€ Eviction rate                                      â”‚
â”‚                                                             â”‚
â”‚  4. Database Metrics                                       â”‚
â”‚     â”œâ”€â”€ Query performance                                  â”‚
â”‚     â”œâ”€â”€ Connection pool                                    â”‚
â”‚     â”œâ”€â”€ Table sizes                                        â”‚
â”‚     â””â”€â”€ Index usage                                        â”‚
â”‚                                                             â”‚
â”‚  5. Business Metrics                                       â”‚
â”‚     â”œâ”€â”€ Jobs/day                                           â”‚
â”‚     â”œâ”€â”€ Profiles/day                                       â”‚
â”‚     â”œâ”€â”€ Success rate                                       â”‚
â”‚     â””â”€â”€ Processing time                                    â”‚
â”‚                                                             â”‚
â”‚  Tools:                                                    â”‚
â”‚  â”œâ”€â”€ Heroku Metrics Dashboard                             â”‚
â”‚  â”œâ”€â”€ Sentry (errors & performance)                         â”‚
â”‚  â”œâ”€â”€ Supabase Dashboard                                    â”‚
â”‚  â””â”€â”€ Custom logging                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Structure Map

```
server/
â”‚
â”œâ”€â”€ ğŸš€ Core Application
â”‚   â”œâ”€â”€ app.py                    # Main Flask app (refactored)
â”‚   â”œâ”€â”€ wsgi.py                   # Production entry point
â”‚   â”œâ”€â”€ celery_config.py          # Task queue config
â”‚   â”œâ”€â”€ tasks.py                  # Background tasks
â”‚   â””â”€â”€ api_async.py              # Async endpoints
â”‚
â”œâ”€â”€ ğŸ”§ Utilities
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ scraper.py            # Apify integration
â”‚       â”œâ”€â”€ gender.py             # Gender detection
â”‚       â””â”€â”€ batch_processor.py   # Batch DB operations
â”‚
â”œâ”€â”€ âš™ï¸ Configuration
â”‚   â”œâ”€â”€ requirements.txt          # Python dependencies
â”‚   â”œâ”€â”€ Procfile                  # Heroku dyno config
â”‚   â”œâ”€â”€ runtime.txt               # Python version
â”‚   â””â”€â”€ .env                      # Environment variables
â”‚
â”œâ”€â”€ ğŸ—„ï¸ Database
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 001_add_job_tracking.sql
â”‚
â”œâ”€â”€ ğŸ“š Documentation
â”‚   â”œâ”€â”€ README.md                 # Complete overview
â”‚   â”œâ”€â”€ DEPLOYMENT.md             # Heroku deployment
â”‚   â”œâ”€â”€ TESTING.md                # Testing guide
â”‚   â”œâ”€â”€ TRANSFORMATION_SUMMARY.md # What changed
â”‚   â”œâ”€â”€ COMPLETION_SUMMARY.md     # Quick reference
â”‚   â””â”€â”€ ARCHITECTURE.md           # This file
â”‚
â””â”€â”€ ğŸ› ï¸ Scripts
    â”œâ”€â”€ quickstart.sh             # Local dev setup
    â”œâ”€â”€ test_api.sh               # API testing
    â””â”€â”€ start_all.sh              # Start all services
```

---

**This architecture supports:**
- âœ… 1,000,000+ accounts/month
- âœ… Horizontal scaling (add more workers)
- âœ… Fault tolerance (automatic retries)
- âœ… Real-time progress tracking
- âœ… Efficient memory usage (< 1GB/worker)
- âœ… Zero-downtime deployments
